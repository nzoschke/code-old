#!/bin/bash
set -xeo pipefail

BIN_DIR=$(cd $(dirname $0); pwd) # absolute path
APP_DIR=$(dirname $BIN_DIR)

REPO_URL=$1
WORK_DIR=$2
REPO_DIR=$WORK_DIR/.git

(
  cd $WORK_DIR
  find . -mindepth 1 | xargs rm -rfv
  mkdir -p .git

  STATUS=$(curl -o repo.tgz -w "%{http_code}" "$REPO_URL")
  [ $STATUS == "200" ] && tar xfvz repo.tgz || git init .

  rm -rf $REPO_DIR/hooks
  cp -R $APP_DIR/etc/hooks $REPO_DIR
)